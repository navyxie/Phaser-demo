function preload(){game.load.spritesheet("containers","assets/containers.png",60,60);game.load.spritesheet("buttons","assets/buttons.png",285,100);game.load.bitmapFont("wlfont","assets/wl_font_0.png","assets/wl_font.xml");game.load.image("grab","assets/grab.png");game.load.image("bg","assets/bg.png");game.load.image("fore","assets/fore.png");game.load.image("title","assets/title.png");game.load.image("help","assets/help.png");game.load.spritesheet("submit","assets/submit_spritesheet.png",130,46);game.load.image("gameOverCont","assets/gameOverCont.png");game.load.spritesheet("subcontbuttons","assets/subcontbuttons.png",100,20);game.load.image("hsbg","assets/highscoresbg.png");game.load.image("logo","assets/marlins_logo.png");game.load.image("seasons","assets/seasons.png");game.load.spritesheet("close","assets/close.png",53,53);game.load.image("snowa","assets/snow1.png");game.load.image("snowb","assets/snow2.png");game.load.image("snowc","assets/snow3.png");game.stage.disableVisibilityChange=true;game.input.maxPointers=1;this.game.canvas.id="gamecanvas";jQuery.get("dic/en_GB.aff",function(e){affFile=e;jQuery.get("dic/en_GB.dic",function(e){dicFile=e;dictionary=new Typo("en_GB",affFile,dicFile)})})}function create(){document.getElementById("loading").style.display="none";if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){game.stage.scaleMode=Phaser.StageScaleMode.SHOW_ALL;game.stage.scale.setShowAll();game.stage.scale.refresh()}game.add.sprite(0,0,"bg");fg=game.add.sprite(58,387,"fore");var e="";var t={font:"bold 20pt Arial",fill:"#ffffff",align:"center"};currentWordText=game.add.bitmapText(240,550,e,{font:"40px Flipbash",align:"center"});currentWordText.anchor.setTo(.5,.5);grab=game.add.sprite(100,-322,"grab");grab.anchor.setTo(.5,.5);scoreText=game.add.bitmapText(400,20,"Score: 0",{font:"25px Flipbash",align:"left"});scoreText.anchor.setTo(.5,.5);score=0;scoreText.alpha=0;playBtn=game.add.button(game.world.centerX,-100,"buttons",playOnClick,this,1,0,1);helpBtn=game.add.button(game.world.centerX,-100,"buttons",helpOnClick,this,3,2,2);scoresBtn=game.add.button(game.world.centerX,-100,"buttons",scoresOnClick,this,5,4,4);submitBtn=game.add.button(game.world.centerX,-460,"submit",submitWord,this,1,0,2);submitBtn.anchor.setTo(.5,.5);submitBtn.alpha=0;playBtn.anchor.setTo(.5,.5);helpBtn.anchor.setTo(.5,.5);scoresBtn.anchor.setTo(.5,.5);allContainersGroup=game.add.group();gameOverGroup=game.add.group();gameOverGroup.create(0,0,"gameOverCont");title=game.add.sprite(game.world.centerX+50,50,"title");title.anchor.setTo(.5,.5);logo=game.add.sprite(70,60,"logo");logo.anchor.setTo(.5,.5);seasons=game.add.sprite(game.world.centerX,690,"seasons");seasons.anchor.setTo(.5,.5);var n=game.add.button(40,90,"subcontbuttons",continueOnClick,this,1,0,1);var r=game.add.button(229,90,"subcontbuttons",submitOnClick,this,3,2,3);var e="GAME OVER\nSCORE: ";gameOverText=game.add.bitmapText(182,40,e,{font:"30px Flipbash",align:"center"});gameOverText.anchor.setTo(.5,.5);gameOverGroup.add(n);gameOverGroup.add(r);gameOverGroup.add(gameOverText);gameOverGroup.x=55;gameOverGroup.y=-130;fg.bringToTop();seasons.bringToTop();emitter=game.add.emitter(game.world.centerX,-100,200);emitter.makeParticles(["snowa","snowb","snowc"]);emitter.gravity=.5;emitter.particleDrag.x=0;emitter.start(false,1e4,20);bringInButtons()}function update(){if(game.input.keyboard.isDown(Phaser.Keyboard.SPACEBAR)&&game.time.now>submitTimer&&!gameOver){submitTimer=game.time.now+1e3;submitWord()}}function bringInButtons(){logo.scale.setTo(0,0);title.scale.setTo(0,0);title.angle=-40;seasons.bringToTop();game.add.tween(logo.scale).to({x:1,y:1},2e3,Phaser.Easing.Elastic.Out,true,0,false);game.add.tween(title.scale).to({x:1,y:1},2e3,Phaser.Easing.Elastic.Out,true,1e3,false);game.add.tween(title).to({angle:0},1500,Phaser.Easing.Elastic.Out,true,1e3,false);game.add.tween(seasons).to({y:450},1500,Phaser.Easing.Back.Out,true,2e3,false);game.add.tween(scoresBtn).to({y:380},1e3,Phaser.Easing.Cubic.Out,true);game.add.tween(scoresBtn).to({y:380},1e3,Phaser.Easing.Cubic.Out,true);game.add.tween(helpBtn).to({y:280},1e3,Phaser.Easing.Cubic.Out,true,500);var e=game.add.tween(playBtn);e.to({y:180},1e3,Phaser.Easing.Cubic.Out,true,1e3);e.onComplete.add(enableButtons,null);e.start()}function bringOutButtons(){game.add.tween(logo.scale).to({x:0,y:0},1e3,Phaser.Easing.Cubic.Out,true,0,false);game.add.tween(seasons).to({y:690},1500,Phaser.Easing.Cubic.Out,true,100,false);game.add.tween(title.scale).to({x:0,y:0},1e3,Phaser.Easing.Back.In,true,0,false);game.add.tween(title).to({angle:-40},1e3,Phaser.Easing.Elastic.In,true,0,false);game.add.tween(playBtn).to({y:-100},600,Phaser.Easing.Cubic.In,true,0,false);game.add.tween(helpBtn).to({y:-100},600,Phaser.Easing.Cubic.In,true,300,false);var e=game.add.tween(scoresBtn);e.to({y:-100},600,Phaser.Easing.Cubic.In,true,600,false);e._lastChild.onComplete.add(resetVarsForNewGame,this);e.start()}function submitButtonShowHide(e){if(e=="show"){submitBtn.y=460;game.add.tween(submitBtn).to({alpha:1},1e3,Phaser.Easing.Linear.None,true,0,false)}else if(e=="hide"){submitBtn.y=-460;submitBtn.alpha=0}}function enableButtons(){btnsEnabled=true}function disableButtons(){btnsEnabled=false}function playOnClick(){if(btnsEnabled){bringOutButtons();disableButtons()}}function helpOnClick(){if(btnsEnabled){disableButtons();helpGroup=game.add.group();var e=game.add.sprite(0,0,"help");var t=game.add.button(395,10,"close",closeHelp,this,1,0,1);helpGroup.add(e);helpGroup.add(t);helpGroup.x=20;helpGroup.y=-300;game.add.tween(helpGroup).to({y:120},1500,Phaser.Easing.Elastic.Out,true,0,false)}}function closeHelp(){var e=game.add.tween(helpGroup);e.to({y:-500},500,Phaser.Easing.Back.In,true,0,false);e.onComplete.add(enableButtons,this);e.start()}function scoresOnClick(){if(btnsEnabled){disableButtons();$.getJSON("getscores.php",function(e){buildHighScores(e)})}}function continueOnClick(){var e=game.add.tween(gameOverGroup);e.to({y:-130},1200,Phaser.Easing.Cubic.Out,true);e.onComplete.add(bringInButtons,null);e.start();game.add.tween(scoreText).to({alpha:0},1e3,Phaser.Easing.Linear.None,true,0,false);$("#login").fadeOut("slow")}function submitOnClick(){game.add.tween(gameOverGroup).to({y:-130},1200,Phaser.Easing.Cubic.Out,true);game.add.tween(scoreText).to({alpha:0},1e3,Phaser.Easing.Linear.None,true,0,false);$("#login").fadeIn("slow")}function sumbitHighScore(){userName=document.getElementById("userName").value;userEmail=document.getElementById("email").value;userCompany=document.getElementById("company").value;if(!userName){formfeedback.innerHTML="Please enter your name";return false}var e=userEmail.indexOf("@");var t=userEmail.lastIndexOf(".");if(e<1||t<e+2||t+2>=userEmail.length){formfeedback.innerHTML="Please enter a valid email address";return false}$("#login").fadeOut("slow");var n="uname="+userName+"&company="+userCompany+"&email="+userEmail+"&score="+score;$.post("insertscore.php",n,function(e){if(e=="error"){}else{var t=e.split("=");userRank=t[1]}$.getJSON("getscores.php",function(e){buildHighScores(e)})})}function createContainerArray(){for(var e=0;e<contHeight;e++){allContainers[e]=[];for(var t=0;t<contWidth;t++){allContainers[e][t]=0}}}function createLettersArray(){for(var e=0;e<letterCount.length;e++){for(var t=0;t<letterCount[e].c;t++){letters.push(letterCount[e].l)}}}function resetVarsForNewGame(){if(!gameStarted){game.add.tween(scoreText).to({alpha:1},1e3,Phaser.Easing.Linear.None,true,0,false);gameStarted=true;speed=.25;raiseSpeed=600;containerCount=0;allContainersGroup.removeAll();allContainers=[];letters=[];currentWordString="";currentWord=[];score=0;scoreText.setText("Score: "+score);gameOver=false;game.input.keyboard.addKeyCapture([Phaser.Keyboard.SPACEBAR]);createContainerArray();createLettersArray();submitButtonShowHide("show");addContainer()}}function addContainer(){var e=nextEmpty();if(!gameOver){containerCount++;if(containerCount%10==0){speed+=.02;raiseSpeed-=10}var t=e[1]*60+90;var n=-60;var r=game.add.group();var i=getRandomInt(0,9);var s=game.add.button(0,0,"containers",clickedCont,r,3*i+1,3*i,3*i+2);s.anchor.setTo(.5,.5);s.name="cont";var o=randomLetter();var u=game.add.bitmapText(0,0,o,{font:"60px Flipbash",align:"center"});u.anchor.setTo(.5,.5);r.letter=o;r.add(s);r.add(u);r.exploded=false;r.x=t;r.y=n;r.row=e[0];r.col=e[1];r.clicked=false;r.c=s;r.t=u;r.n=i;r.exploded=false;allContainersGroup.add(r._container);lowerContainer(r,e[0],true);fg.bringToTop()}else{doGameOver()}}function lowerContainer(e,t,n){var r=400-t*60;var i=r-e.y;var s=i/speed;lowerCcont=e;lowerC=game.add.tween(e);lowerC.to({y:r},s,Phaser.Easing.Cubic.Out);lowerC.onComplete.add(addContainerToArray,this);lowerC.start();if(n){grab.x=e.x;grab.y=-322;lowerG=game.add.tween(grab);lowerG.to({y:r-262},s,Phaser.Easing.Cubic.Out);lowerG.onComplete.add(raiseGrab,this);lowerG.start()}else{lowerG.onComplete.removeAll();lowerG=game.add.tween(grab);lowerG.to({y:r-262},s,Phaser.Easing.Cubic.Out);lowerG.onComplete.add(raiseGrab,this);lowerG.start()}}function raiseGrab(){var e=game.add.tween(grab);e.to({y:-322},raiseSpeed,Phaser.Easing.Cubic.In);e.onComplete.add(addContainer,this);e.start()}function addContainerToArray(){allContainers[lowerCcont.row][lowerCcont.col]=lowerCcont}function printArray(){var e="";for(var t=contHeight-1;t>=0;t--){e="[";for(var n=0;n<contWidth;n++){if(allContainers[t][n]==0){e+="0, "}else{e+="1, "}}e+="]"}}function nextEmpty(){for(var e=0;e<contHeight;e++){for(var t=0;t<contWidth;t++){if(allContainers[e][t]==0){return[e,t]}}}gameOver=true}function nextEmptyInColumn(e){for(var t=0;t<contHeight;t++){if(allContainers[t][e]==0){return t}}}function submitWord(){var e=game.add.tween(currentWordText);if(checkCurrentWord()){var t=currentWordString.length;score+=t+(t-3)*t;scoreText.setText("Score: "+score);removeContainers();moveContainersDown();e.to({alpha:0},1e3,Phaser.Easing.Linear.None);e.onComplete.add(clearCurrentWord,this);e.start()}else{e.to({x:250},50,Phaser.Easing.Linear.None).to({x:230},100,Phaser.Easing.Linear.None).to({x:250},100,Phaser.Easing.Linear.None).to({x:230},100,Phaser.Easing.Linear.None).to({x:240},50,Phaser.Easing.Linear.None);e._lastChild.onComplete.add(clearCurrentWord,this);e.start()}}function removeContainers(){lowerC.pause();printArray();for(var e=0;e<currentWord.length;e++){var t=currentWord[e].cont;allContainers[t.row][t.col]=0;t.c.destroy();t.destroy()}printArray()}function moveContainersDown(){for(var e=0;e<contHeight-1;e++){for(var t=0;t<contWidth;t++){if(allContainers[e][t]==0){checkForContainersAbove(e,t)}}}printArray();var n=nextEmptyInColumn(lowerCcont.col);if(n<lowerCcont.row){lowerC.stop();lowerCcont.row=n;lowerContainer(lowerCcont,n,false)}else{lowerC.resume()}}function checkForContainersAbove(e,t){var n=0;for(var r=e+1;r<contHeight;r++){if(allContainers[r][t]!=0){var i=getLowestRow(t);if(i!=-1){var s=allContainers[r][t];allContainers[i][t]=s;allContainers[r][t]=0;s.row=i;game.add.tween(s).to({y:400-i*60},500,Phaser.Easing.Bounce.Out,true,n);n+=50}}}}function getLowestRow(e){for(var t=0;t<contHeight;t++){if(allContainers[t][e]==0){return t}}return-1}function clickedCont(){if(!gameOver){if(this.clicked){clearCurrentWord()}else{currentWord.push({l:this.letter,cont:this});currentWordString+=this.letter;currentWordText.setText(currentWordString);this.clicked=true;if(isEven(this.n)){this.c.setFrames(30,31,32)}else{this.c.setFrames(33,34,35)}}}}function checkCurrentWord(){var e=currentWordString.toLowerCase();if(e.length<3){return false}else if(dictionary.check(e)){return true}else{return false}}function clearCurrentWord(){for(var e=0;e<currentWord.length;e++){currentWord[e].cont.clicked=false;currentWord[e].cont.c.setFrames(currentWord[e].cont.n*3+1,currentWord[e].cont.n*3,currentWord[e].cont.n*3+2)}currentWord=[];currentWordString="";currentWordText.setText("");currentWordText.scale.setTo(1,1);currentWordText.alpha=1}function doGameOver(){gameStarted=false;clearCurrentWord();submitButtonShowHide("hide");gameOverText.setText("GAME OVER\nSCORE: "+score);game.add.tween(gameOverGroup).to({y:300},1200,Phaser.Easing.Cubic.Out,true);allContainersGroup.forEach(stopButtons,this,true)}function stopButtons(e){e.outOfBoundsKill=true;e.bringToTop();e.group.outOfBoundsKill=true;if(e.name=="cont"&&e.group.exploded==false){e.group.exploded=true;e.freezeFrames=true;explode(e.group)}}function explode(e){var t;if(e.col<3){t=getRandomInt(e.x-100,e.x)}else{t=getRandomInt(e.x,e.x+100)}var n=getRandomInt(300,600);var r=getRandomInt(-90,90);var i=-50*e.row+250;game.add.tween(e).to({x:t},n,Phaser.Easing.Cubic.In,true,i,false);game.add.tween(e).to({y:700},n,Phaser.Easing.Cubic.In,true,i,false);game.add.tween(e).to({angle:r},n,Phaser.Easing.Linear.None,true,i,false)}function buildHighScores(e){hsGroup=game.add.group();var t=game.add.button(395,10,"close",closeHighScores,this,1,0,1);var n=game.add.sprite(0,0,"hsbg");hsGroup.add(n);hsGroup.add(t);var r="\n";var s="Name\n";var o="Company\n";var u="Score\n";var a={font:"15px Arial Bold",fill:"#000033",align:"left"};for(i=0;i<e.length;i++){r+="\n"+(i+1);s+="\n"+e[i].username;o+="\n"+e[i].company;u+="\n"+e[i].score}if(userRank>15&&userName){r+="\n\nYour Score\n\n"+userRank;s+="\n\n\n\n"+userName;o+="\n\n\n\n"+userCompany;u+="\n\n\n\n"+score}var f=game.add.text(7,60,r,a);var l=game.add.text(40,60,s,a);var c=game.add.text(185,60,o,a);var h=game.add.text(350,60,u,a);hsGroup.add(f);hsGroup.add(l);hsGroup.add(c);hsGroup.add(h);hsGroup.x=20;hsGroup.y=-300;game.add.tween(hsGroup).to({y:120},1500,Phaser.Easing.Elastic.Out,true,0,false)}function closeHighScores(){var e=game.add.tween(hsGroup);e.to({y:-500},500,Phaser.Easing.Back.In,true,0,false);if(playBtn.y<0){e.onComplete.add(bringInButtons,this)}else{enableButtons()}e.start()}function randomLetter(){var e=Math.floor(Math.random()*letters.length);var t=letters[e];letters.splice(e,1);if(letters.length==0){createLettersArray()}return t}function getRandomInt(e,t){return Math.floor(Math.random()*(t-e+1))+e}function isEven(e){return e%2==0}var affFile;var dicFile;var dictionary;var gameOver=false;var gameStarted=false;var allContainers=[];var allContainersGroup;var containerCount=0;var contHeight=5;var contWidth=6;var letters=[];var currentWordText;var currentWordString="";var currentWord=[];var scoreText;var score;var submitTimer=0;var lowerC;var lowerG;var lowerCcont;var grab;var fg;var title;var logo;var seasons;var playBtn;var helpBtn;var scoresBtn;var btnsEnabled=false;var gameOverGroup;var helpGroup;var gameOverText;var userName="";var userEmail="";var userCompany="";var loadingImage;var userName;var userCompany;var userRank;var preloadBar;var emitter;var speed=.25;var raiseSpeed=600;var letterCount=[{l:"A",c:9},{l:"B",c:2},{l:"C",c:2},{l:"D",c:4},{l:"E",c:12},{l:"F",c:2},{l:"G",c:3},{l:"H",c:2},{l:"I",c:9},{l:"J",c:1},{l:"K",c:1},{l:"L",c:4},{l:"M",c:3},{l:"N",c:6},{l:"O",c:8},{l:"P",c:2},{l:"Q",c:1},{l:"R",c:6},{l:"S",c:5},{l:"T",c:6},{l:"U",c:4},{l:"V",c:2},{l:"W",c:2},{l:"X",c:1},{l:"Y",c:2},{l:"Z",c:1}]